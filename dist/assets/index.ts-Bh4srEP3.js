(function(){var m=Object.defineProperty;var p=(r,e,t)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>p(r,typeof e!="symbol"?e+"":e,t);const u={callButton:".switch-state-block__item:first-child",putButton:".switch-state-block__item:last-child",amountInput:'#put-call-buttons-chart-1 input[type="text"]',expirationDisplay:".block--expiration-inputs .value__val",balanceDisplay:".balance-info-block__value",balanceLabel:".balance-info-block__label",tickerSelector:".chart-item .pair",chartContainer:".chart-item",priceDisplay:".chart-item",demoIndicator:".balance-info-block__label"};function f(){var e;if(window.location.pathname.includes("demo")||document.querySelector(".is-chart-demo"))return!0;const r=document.querySelector(u.demoIndicator);return!!((e=r==null?void 0:r.textContent)!=null&&e.toLowerCase().includes("demo"))}function T(){var o,c;const r=window.location.pathname.includes("demo"),e=!!document.querySelector(".is-chart-demo"),n=(((c=(o=document.querySelector(u.demoIndicator))==null?void 0:o.textContent)==null?void 0:c.toLowerCase())||"").includes("demo");return r&&e&&n?{type:"DEMO",confidence:"high"}:r?{type:"DEMO",confidence:"medium"}:!r&&!n?{type:"LIVE",confidence:"medium"}:{type:"UNKNOWN",confidence:"low"}}class y{constructor(e){s(this,"selectors");s(this,"observer",null);s(this,"_isCollecting",!1);s(this,"currentPrice",null);s(this,"priceHistory",[]);s(this,"maxHistorySize",1e3);this.selectors=e}get isCollecting(){return this._isCollecting}start(){this._isCollecting||(console.log("[DataCollector] Starting data collection..."),this._isCollecting=!0,this.setupPriceObserver())}stop(){var e;this._isCollecting&&(console.log("[DataCollector] Stopping data collection..."),(e=this.observer)==null||e.disconnect(),this.observer=null,this._isCollecting=!1)}getCurrentPrice(){return this.currentPrice}getPriceHistory(){return[...this.priceHistory]}getRecentPrices(e){return this.priceHistory.slice(-e).map(t=>t.price)}setupPriceObserver(){const e=document.querySelector(this.selectors.priceDisplay);if(!e){console.warn("[DataCollector] Price element not found. Selectors may need updating.");return}this.observer=new MutationObserver(t=>{for(const n of t)(n.type==="characterData"||n.type==="childList")&&this.handlePriceUpdate(e)}),this.observer.observe(e,{characterData:!0,childList:!0,subtree:!0}),this.handlePriceUpdate(e)}handlePriceUpdate(e){var o;const t=(o=e.textContent)==null?void 0:o.trim();if(!t)return;const n=this.parsePrice(t);n!==null&&(this.currentPrice=n,this.recordTick(n))}parsePrice(e){const t=e.replace(/[^0-9.]/g,""),n=parseFloat(t);return isNaN(n)?null:n}recordTick(e){const t={ticker:this.getCurrentTicker(),timestamp:Date.now(),price:e};this.priceHistory.push(t),this.priceHistory.length>this.maxHistorySize&&(this.priceHistory=this.priceHistory.slice(-this.maxHistorySize)),this.notifyPriceUpdate(t)}getCurrentTicker(){var t;const e=document.querySelector(this.selectors.tickerSelector);return((t=e==null?void 0:e.textContent)==null?void 0:t.trim())||"UNKNOWN"}notifyPriceUpdate(e){chrome.runtime.sendMessage({type:"TICK_DATA",payload:e}).catch(()=>{})}}class b{constructor(e){s(this,"selectors");s(this,"_isTrading",!1);s(this,"tradingLoop",null);s(this,"_allowLiveTrading",!1);this.selectors=e}get isTrading(){return this._isTrading}isInDemoMode(){return f()}getAccountInfo(){return T()}enableLiveTrading(e){e&&(console.warn("[TradeExecutor] âš ï¸ LIVE TRADING ENABLED - Real money at risk!"),this._allowLiveTrading=!0)}disableLiveTrading(){this._allowLiveTrading=!1,console.log("[TradeExecutor] Live trading disabled - Demo only mode")}startAutoTrading(){if(this._isTrading)return{success:!1,message:"Already trading"};const e=this.getAccountInfo();if(e.type!=="DEMO")if(this._allowLiveTrading)console.warn("[TradeExecutor] âš ï¸ Starting auto-trading on LIVE account!");else{const t=`ðŸš« BLOCKED: Cannot start auto-trading on ${e.type} account. Demo mode required for safety. (Confidence: ${e.confidence})`;return console.error("[TradeExecutor]",t),{success:!1,message:t}}return console.log("[TradeExecutor] Starting auto-trading (Demo mode verified)..."),this._isTrading=!0,{success:!0,message:"Auto-trading started (Demo mode)"}}stopAutoTrading(){return this._isTrading?(console.log("[TradeExecutor] Stopping auto-trading..."),this.tradingLoop&&(clearInterval(this.tradingLoop),this.tradingLoop=null),this._isTrading=!1,{success:!0,message:"Auto-trading stopped"}):{success:!1,message:"Not trading"}}async executeTrade(e,t){console.log(`[TradeExecutor] Executing ${e} trade...`);try{const n=this.getAccountInfo();if(n.type!=="DEMO"&&!this._allowLiveTrading){const l=`ðŸš« BLOCKED: Cannot execute trade on ${n.type} account. Demo mode required.`;return console.error("[TradeExecutor]",l),{success:!1,error:l}}n.type!=="DEMO"&&this._allowLiveTrading&&console.warn(`[TradeExecutor] âš ï¸ Executing ${e} trade on LIVE account!`);const o=this.validateTradeConditions();if(!o.canTrade)return{success:!1,error:o.reason};const c=this.getTradeButton(e);return c?(t&&await this.setTradeAmount(t),this.simulateClick(c),chrome.runtime.sendMessage({type:"TRADE_EXECUTED",payload:{direction:e,amount:t,timestamp:Date.now()}}),{success:!0}):{success:!1,error:`${e} button not found`}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}getTradeButton(e){const t=e==="CALL"?this.selectors.callButton:this.selectors.putButton;return document.querySelector(t)}validateTradeConditions(){const e=document.querySelector(this.selectors.callButton),t=document.querySelector(this.selectors.putButton);return!e||!t?{canTrade:!1,reason:"Trade buttons not found"}:{canTrade:!0}}async setTradeAmount(e){const t=document.querySelector(this.selectors.amountInput);if(!t){console.warn("[TradeExecutor] Amount input not found");return}t.value=e.toString(),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),console.log(`[TradeExecutor] Amount set to ${e}`)}simulateClick(e){const t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}getCurrentBalance(){var c;const e=document.querySelector(this.selectors.balanceDisplay);if(!e)return null;const n=(((c=e.textContent)==null?void 0:c.trim())||"").replace(/[^0-9.]/g,""),o=parseFloat(n);return isNaN(o)?null:o}}let a=null,i=null,g=!1;async function h(){if(g)return;console.log("[Pocket Quant] Content script initializing..."),await C("body");const r=await w();a=new y(r),i=new b(r),a.start(),g=!0,console.log("[Pocket Quant] Content script initialized")}async function w(){try{return(await chrome.storage.local.get("domSelectors")).domSelectors||u}catch{return u}}function C(r,e=1e4){return new Promise(t=>{const n=document.querySelector(r);if(n){t(n);return}const o=new MutationObserver((c,l)=>{const d=document.querySelector(r);d&&(l.disconnect(),t(d))});o.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{o.disconnect(),t(null)},e)})}chrome.runtime.onMessage.addListener((r,e,t)=>(E(r).then(t),!0));async function E(r){switch(r.type){case"START_TRADING":return i==null?void 0:i.startAutoTrading();case"STOP_TRADING":return i==null?void 0:i.stopAutoTrading();case"GET_STATUS":return{isCollecting:(a==null?void 0:a.isCollecting)??!1,isTrading:(i==null?void 0:i.isTrading)??!1,currentPrice:a==null?void 0:a.getCurrentPrice()};default:return console.warn("[Pocket Quant] Unknown message type:",r.type),null}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h();
})()
